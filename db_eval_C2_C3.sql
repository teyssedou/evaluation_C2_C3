-- MySQL Script generated by MySQL Workbench
-- mar. 02 oct. 2018 15:50:53 CEST
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS
, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS
, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE
, SQL_MODE='TRADITIONAL,ALLOW_INVALID_DATES';

-- -----------------------------------------------------
-- Schema db_evaluation_C2_C3
-- -----------------------------------------------------
DROP SCHEMA IF EXISTS `db_evaluation_C2_C3`
;

-- -----------------------------------------------------
-- Schema db_evaluation_C2_C3
-- -----------------------------------------------------
CREATE SCHEMA
IF NOT EXISTS `db_evaluation_C2_C3` DEFAULT CHARACTER
SET utf8 ;
USE `db_evaluation_C2_C3`
;

-- -----------------------------------------------------
-- Table `db_evaluation_C2_C3`.`categories`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `db_evaluation_C2_C3`.`categories` ;

CREATE TABLE
IF NOT EXISTS `db_evaluation_C2_C3`.`categories`
(
  `id` INT NOT NULL AUTO_INCREMENT,
  `name_category` VARCHAR
(90) NOT NULL,
  PRIMARY KEY
(`id`),
  UNIQUE INDEX `name_category_UNIQUE`
(`name_category` ASC))
ENGINE = InnoDB
DEFAULT CHARACTER
SET = utf8;


-- -----------------------------------------------------
-- Table `db_evaluation_C2_C3`.`units`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `db_evaluation_C2_C3`.`units` ;

CREATE TABLE
IF NOT EXISTS `db_evaluation_C2_C3`.`units`
(
  `id` INT NOT NULL AUTO_INCREMENT,
  `name_unit` VARCHAR
(90) NOT NULL,
  PRIMARY KEY
(`id`),
  UNIQUE INDEX `name_unit_UNIQUE`
(`name_unit` ASC))
ENGINE = InnoDB
DEFAULT CHARACTER
SET = utf8;


-- -----------------------------------------------------
-- Table `db_evaluation_C2_C3`.`articles`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `db_evaluation_C2_C3`.`articles` ;

CREATE TABLE
IF NOT EXISTS `db_evaluation_C2_C3`.`articles`
(
  `id` INT NOT NULL AUTO_INCREMENT,
  `name_article` VARCHAR
(90) NULL,
  `sell_price` DECIMAL
(10,2) NULL,
  `category_id` INT NOT NULL,
  `unit_id` INT NOT NULL,
  PRIMARY KEY
(`id`),
  INDEX `fk_articles_categories1_idx`
(`category_id` ASC),
  INDEX `fk_articles_units1_idx`
(`unit_id` ASC),
  UNIQUE INDEX `name_article_UNIQUE`
(`name_article` ASC),
  CONSTRAINT `fk_articles_categories1`
    FOREIGN KEY
(`category_id`)
    REFERENCES `db_evaluation_C2_C3`.`categories`
(`id`)
    ON
DELETE NO ACTION
    ON
UPDATE NO ACTION,
  CONSTRAINT `fk_articles_units1`
    FOREIGN KEY
(`unit_id`)
    REFERENCES `db_evaluation_C2_C3`.`units`
(`id`)
    ON
DELETE NO ACTION
    ON
UPDATE NO ACTION)
ENGINE = InnoDB
DEFAULT CHARACTER
SET = utf8;


-- -----------------------------------------------------
-- Table `db_evaluation_C2_C3`.`suppliers`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `db_evaluation_C2_C3`.`suppliers` ;

CREATE TABLE
IF NOT EXISTS `db_evaluation_C2_C3`.`suppliers`
(
  `id` INT NOT NULL AUTO_INCREMENT,
  `name_supplier` VARCHAR
(90) NOT NULL,
  PRIMARY KEY
(`id`),
  UNIQUE INDEX `name_supplier_UNIQUE`
(`name_supplier` ASC))
ENGINE = InnoDB
DEFAULT CHARACTER
SET = utf8;


-- -----------------------------------------------------
-- Table `db_evaluation_C2_C3`.`purchases`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `db_evaluation_C2_C3`.`purchases` ;

CREATE TABLE
IF NOT EXISTS `db_evaluation_C2_C3`.`purchases`
(
  `id` INT NOT NULL AUTO_INCREMENT,
  `date` TIMESTAMP NULL,
  `supplier_id` INT NOT NULL,
  PRIMARY KEY
(`id`),
  INDEX `fk_purchases_suppliers1_idx`
(`supplier_id` ASC),
  CONSTRAINT `fk_purchases_suppliers1`
    FOREIGN KEY
(`supplier_id`)
    REFERENCES `db_evaluation_C2_C3`.`suppliers`
(`id`)
    ON
DELETE NO ACTION
    ON
UPDATE NO ACTION)
ENGINE = InnoDB
DEFAULT CHARACTER
SET = utf8;


-- -----------------------------------------------------
-- Table `db_evaluation_C2_C3`.`directions`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `db_evaluation_C2_C3`.`directions` ;

CREATE TABLE
IF NOT EXISTS `db_evaluation_C2_C3`.`directions`
(
  `id` INT NOT NULL AUTO_INCREMENT,
  `name_direction` VARCHAR
(45) NULL,
  PRIMARY KEY
(`id`),
  UNIQUE INDEX `name-direction_UNIQUE`
(`name_direction` ASC))
ENGINE = InnoDB
DEFAULT CHARACTER
SET = utf8;


-- -----------------------------------------------------
-- Table `db_evaluation_C2_C3`.`movement_types`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `db_evaluation_C2_C3`.`movement_types` ;

CREATE TABLE
IF NOT EXISTS `db_evaluation_C2_C3`.`movement_types`
(
  `id` INT NOT NULL AUTO_INCREMENT,
  `name_movement_type` VARCHAR
(90) NULL,
  `direction_id` INT NOT NULL,
  PRIMARY KEY
(`id`, `direction_id`),
  INDEX `fk_movement_types_directions1_idx`
(`direction_id` ASC),
  UNIQUE INDEX `name_movement_type_UNIQUE`
(`name_movement_type` ASC),
  CONSTRAINT `fk_movement_types_directions1`
    FOREIGN KEY
(`direction_id`)
    REFERENCES `db_evaluation_C2_C3`.`directions`
(`id`)
    ON
DELETE NO ACTION
    ON
UPDATE NO ACTION)
ENGINE = InnoDB
DEFAULT CHARACTER
SET = utf8;


-- -----------------------------------------------------
-- Table `db_evaluation_C2_C3`.`sells`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `db_evaluation_C2_C3`.`sells` ;

CREATE TABLE
IF NOT EXISTS `db_evaluation_C2_C3`.`sells`
(
  `id` INT NOT NULL AUTO_INCREMENT,
  `date` TIMESTAMP NULL,
  PRIMARY KEY
(`id`))
ENGINE = InnoDB
DEFAULT CHARACTER
SET = utf8;


-- -----------------------------------------------------
-- Table `db_evaluation_C2_C3`.`movements`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `db_evaluation_C2_C3`.`movements` ;

CREATE TABLE
IF NOT EXISTS `db_evaluation_C2_C3`.`movements`
(
  `id` INT NOT NULL AUTO_INCREMENT,
  `quantity` DECIMAL
(10,2) NOT NULL,
  `date` TIMESTAMP NOT NULL,
  `purchase_id` INT NULL,
  `movement_type_id` INT NOT NULL,
  `article_id` INT NOT NULL,
  `sells_id` INT NULL,
  PRIMARY KEY
(`id`),
  INDEX `fk_movements_purchases1_idx`
(`purchase_id` ASC),
  INDEX `fk_movements_movement_types1_idx`
(`movement_type_id` ASC),
  INDEX `fk_movements_articles1_idx`
(`article_id` ASC),
  INDEX `fk_movements_sells1_idx`
(`sells_id` ASC),
  CONSTRAINT `fk_movements_purchases1`
    FOREIGN KEY
(`purchase_id`)
    REFERENCES `db_evaluation_C2_C3`.`purchases`
(`id`)
    ON
DELETE NO ACTION
    ON
UPDATE NO ACTION,
  CONSTRAINT `fk_movements_movement_types1`
    FOREIGN KEY
(`movement_type_id`)
    REFERENCES `db_evaluation_C2_C3`.`movement_types`
(`id`)
    ON
DELETE NO ACTION
    ON
UPDATE NO ACTION,
  CONSTRAINT `fk_movements_articles1`
    FOREIGN KEY
(`article_id`)
    REFERENCES `db_evaluation_C2_C3`.`articles`
(`id`)
    ON
DELETE NO ACTION
    ON
UPDATE NO ACTION,
  CONSTRAINT `fk_movements_sells1`
    FOREIGN KEY
(`sells_id`)
    REFERENCES `db_evaluation_C2_C3`.`sells`
(`id`)
    ON
DELETE NO ACTION
    ON
UPDATE NO ACTION)
ENGINE = InnoDB
DEFAULT CHARACTER
SET = utf8;


-- -----------------------------------------------------
-- Table `db_evaluation_C2_C3`.`articles_suppliers`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `db_evaluation_C2_C3`.`articles_suppliers` ;

CREATE TABLE
IF NOT EXISTS `db_evaluation_C2_C3`.`articles_suppliers`
(
  `article_id` INT NOT NULL,
  `supplier_id` INT NOT NULL,
  `purchase_price` DECIMAL
(10,2) NOT NULL,
  INDEX `fk_articles_has_suppliers_suppliers1_idx`
(`supplier_id` ASC),
  INDEX `fk_articles_has_suppliers_articles1_idx`
(`article_id` ASC),
  PRIMARY KEY
(`article_id`, `supplier_id`),
  CONSTRAINT `fk_articles_has_suppliers_articles1`
    FOREIGN KEY
(`article_id`)
    REFERENCES `db_evaluation_C2_C3`.`articles`
(`id`)
    ON
DELETE NO ACTION
    ON
UPDATE NO ACTION,
  CONSTRAINT `fk_articles_has_suppliers_suppliers1`
    FOREIGN KEY
(`supplier_id`)
    REFERENCES `db_evaluation_C2_C3`.`suppliers`
(`id`)
    ON
DELETE NO ACTION
    ON
UPDATE NO ACTION)
ENGINE = InnoDB
DEFAULT CHARACTER
SET = utf8;

SET SQL_MODE
= '';
GRANT USAGE ON *.* TO user_evaltest;
DROP USER user_evaltest;
SET SQL_MODE
='TRADITIONAL,ALLOW_INVALID_DATES';
CREATE USER 'user_evaltest' IDENTIFIED BY 'evalc2c3';

GRANT ALL ON `db_evaluation_C2_C3`.* TO 'user_evaltest';

SET SQL_MODE
=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS
=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS
=@OLD_UNIQUE_CHECKS;
